#include "greatest.h"
#include "compiler.h"

unsigned char luac_out[] = {
  0x1b, 0x4c, 0x75, 0x61, 0x40, 0x01, 0x04, 0x08, 0x08, 0x20, 0x06, 0x09,
  0x08, 0x12, 0xe6, 0x5b, 0xa1, 0xb0, 0xb9, 0xb2, 0x41, 0x08, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x3d, 0x28, 0x6e, 0x6f, 0x6e, 0x65, 0x29,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
unsigned int luac_out_len = 82;

TEST block_program(void) {
  Function f;
  function_init(&f, "=(none)");

  unsigned char chunk[1024];
  compile(&f, chunk);

  ASSERT_MEM_EQ(luac_out, chunk, luac_out_len);
  PASS();
}

GREATEST_MAIN_DEFS();

int main(int argc, char **argv) {
  GREATEST_MAIN_BEGIN();
  RUN_TEST(block_program);
  GREATEST_MAIN_END();
}
